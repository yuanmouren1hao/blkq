/*
**  HoorayOS开源桌面应用框架
**  作者：胡尐睿丶
**  项目地址：http://code.google.com/p/hoorayos
**  我希望能将这项目继续开源下去，所以请手下留情，保留以上这段版权信息
*/

var version="2.0";var ajaxUrl="ajax.php";var zoomlevel=1;var TEMP={};var HROS={};HROS.CONFIG={desk:1,dockPos:"top",appXY:"x",appButtonTop:20,appButtonLeft:20,createIndexid:1,windowMinWidth:215,windowMinHeight:59,wallpaper:"",wallpaperWidth:0,wallpaperHeight:0,wallpaperType:"",wallpaperState:1};HROS.app=(function(){return{getXY:function(a){$.ajax({type:"POST",url:ajaxUrl,data:"ac=getAppXY"}).done(function(b){HROS.CONFIG.appXY=b;if(typeof(a)=="function"){a();}});},updateXY:function(a,b){$.ajax({type:"POST",url:ajaxUrl,data:"ac=setAppXY&appxy="+a}).done(function(){HROS.CONFIG.appXY=a;if(typeof(b)=="function"){b();}});},get:function(){var a=HROS.grid.getAppGrid(),b=HROS.grid.getDockAppGrid();$.getJSON(ajaxUrl+"?ac=getMyApp",function(h){if(h["dock"]!=null){var c="",d={};for(var g=0;g<h["dock"].length;g++){c+=appbtnTemp({"top":b[g]["startY"],"left":b[g]["startX"],"title":h["dock"][g]["name"],"type":h["dock"][g]["type"],"id":"d_"+h["dock"][g]["type"]+"_"+h["dock"][g]["id"],"realid":h["dock"][g]["id"],"imgsrc":h["dock"][g]["icon"]});}$("#dock-bar .dock-applist").html("").append(c);}for(var f=1;f<=5;f++){var e="",d={};if(h["desk"+f]!=null){for(var g=0;g<h["desk"+f].length;g++){e+=appbtnTemp({"top":a[g]["startY"]+7,"left":a[g]["startX"]+16,"title":h["desk"+f][g]["name"],"type":h["desk"+f][g]["type"],"id":"d_"+h["desk"+f][g]["type"]+"_"+h["desk"+f][g]["id"],"realid":h["desk"+f][g]["id"],"imgsrc":h["desk"+f][g]["icon"]});}}e+=addbtnTemp({"top":a[g]["startY"]+7,"left":a[g]["startX"]+16});$("#desk-"+f+" li").remove();$("#desk-"+f).append(e);g=0;}$("#desk").off("click").on("click","li.add",function(){HROS.window.createTemp({id:"yysc",title:"应用市场",url:"sysapp/appmarket/index.php",width:800,height:484,isresize:false,isflash:false});});HROS.app.move();HROS.dock.move();HROS.app.getScrollbar();HROS.app.moveScrollbar();$("#desk").on("contextmenu",".appbtn:not(.add)",function(m){$(".popup-menu").hide();$(".quick_view_container").remove();switch($(this).attr("type")){case"app":case"widget":var k=HROS.popupMenu.app($(this));break;case"papp":case"pwidget":var k=HROS.popupMenu.papp($(this));break;case"folder":var k=HROS.popupMenu.folder($(this));break;}var i=($(document).width()-m.clientX)<k.width()?(m.clientX-k.width()):m.clientX;var j=($(document).height()-m.clientY)<k.height()?(m.clientY-k.height()):m.clientY;k.css({left:i,top:j}).show();return false;});});},add:function(c,b,a){$.ajax({type:"POST",url:ajaxUrl,data:"ac=addMyApp&id="+c+"&type="+b+"&desk="+HROS.CONFIG.desk,success:function(){if(typeof(a)!=="undefined"){a();}}});},remove:function(c,b,a){$.ajax({type:"POST",url:ajaxUrl,data:"ac=delMyApp&id="+c+"&type="+b,success:function(){if(b=="widget"){HROS.widget.removeCookie(c,b);}if(typeof(a)!=="undefined"){a();}}});},move:function(){$("#dock-bar .dock-applist").off("mousedown","li").on("mousedown","li",function(f){f.preventDefault();f.stopPropagation();if(f.button==0||f.button==1){var j=$(this),h,g,b,a,k,i,d,c=$('<li id="shortcut_shadow">'+j.html()+"</li>");k=b=f.clientX;i=a=f.clientY;h=k-j.offset().left;g=i-j.offset().top;$(document).on("mousemove",function(m){$("body").append(c);d=HROS.maskBox.desk();d.show();b=m.clientX<=0?0:m.clientX>=$(document).width()?$(document).width():m.clientX;a=m.clientY<=0?0:m.clientY>=$(document).height()?$(document).height():m.clientY;_l=b-h;_t=a-g;if(k!=b||i!=a){c.css({left:_l,top:_t}).show();}}).on("mouseup",function(){$(document).off("mousemove").off("mouseup");c.remove();if(typeof(d)!=="undefined"){d.hide();}if(k==b&&i==a){switch(j.attr("type")){case"app":case"papp":HROS.window.create(j.attr("realid"),j.attr("type"));break;case"widget":case"pwidget":HROS.widget.create(j.attr("realid"),j.attr("type"));break;case"folder":HROS.folderView.init(j);break;}return false;}var e=HROS.grid.searchFolderGrid(b,a);if(e!=null){if(j.hasClass("folder")==false){$.ajax({type:"POST",url:ajaxUrl,data:"ac=updateMyApp&movetype=dock-folder&id="+j.attr("realid")+"&type="+j.attr("type")+"&from="+j.index()+"&to="+e+"&desk="+HROS.CONFIG.desk,success:function(){j.remove();HROS.deskTop.appresize();if($("#qv_"+e).length!=0){HROS.folderView.init($("#d_folder_"+e));}if($("#w_folder_"+e).length!=0){HROS.window.updateFolder(e,"folder");}}});}}else{var o,p;var s=$("#desk-"+HROS.CONFIG.desk+" li.appbtn:not(.add)").length==0?-1:$("#desk-"+HROS.CONFIG.desk+" li").index(j);var n=$("#dock-bar .dock-applist").html()==""?-1:$("#dock-bar .dock-applist li").index(j);var q=HROS.CONFIG.dockPos=="left"?0:HROS.CONFIG.dockPos=="top"?($(window).width()-$("#dock-bar .dock-applist").width()-20)/2:$(window).width()-$("#dock-bar .dock-applist").width();var u=HROS.CONFIG.dockPos=="top"?0:($(window).height()-$("#dock-bar .dock-applist").height()-20)/2;p=HROS.grid.searchDockAppGrid(b-q,a-u);if(p!=null&&p!=j.index()){$.ajax({type:"POST",url:ajaxUrl,data:"ac=updateMyApp&movetype=dock-dock&id="+j.attr("realid")+"&type="+j.attr("type")+"&from="+j.index()+"&to="+p+"&desk="+HROS.CONFIG.desk,success:function(){if(p<n){$("#dock-bar .dock-applist li:eq("+p+")").before(j);}else{if(p>n){$("#dock-bar .dock-applist li:eq("+p+")").after(j);}}HROS.deskTop.appresize();}});}else{var m=HROS.CONFIG.dockPos=="left"?73:0;var r=HROS.CONFIG.dockPos=="top"?73:0;o=HROS.grid.searchAppGrid(b-m,a-r);if(o!=null){$.ajax({type:"POST",url:ajaxUrl,data:"ac=updateMyApp&movetype=dock-desk&id="+j.attr("realid")+"&type="+j.attr("type")+"&from="+j.index()+"&to="+(o+1)+"&desk="+HROS.CONFIG.desk,success:function(){if(o<s){$("#desk-"+HROS.CONFIG.desk+" li:not(.add):eq("+o+")").before(j);}else{if(o>s){$("#desk-"+HROS.CONFIG.desk+" li:not(.add):eq("+o+")").after(j);}else{if(s==-1){$("#desk-"+HROS.CONFIG.desk+" li.add").before(j);}}}HROS.deskTop.appresize();}});}}}});}return false;});$("#desk .desktop-container").off("mousedown","li:not(.add)").on("mousedown","li:not(.add)",function(f){f.preventDefault();f.stopPropagation();if(f.button==0||f.button==1){var j=$(this),h,g,b,a,k,i,d,c=$('<li id="shortcut_shadow">'+j.html()+"</li>");k=b=f.clientX;i=a=f.clientY;h=k-j.offset().left;g=i-j.offset().top;$(document).on("mousemove",function(m){$("body").append(c);d=HROS.maskBox.desk();d.show();b=m.clientX<=0?0:m.clientX>=$(document).width()?$(document).width():m.clientX;a=m.clientY<=0?0:m.clientY>=$(document).height()?$(document).height():m.clientY;_l=b-h;_t=a-g;if(k!=b||i!=a){c.css({left:_l,top:_t}).show();}}).on("mouseup",function(){$(document).off("mousemove").off("mouseup");c.remove();if(typeof(d)!=="undefined"){d.hide();}if(k==b&&i==a){switch(j.attr("type")){case"app":case"papp":HROS.window.create(j.attr("realid"),j.attr("type"));break;case"widget":case"pwidget":HROS.widget.create(j.attr("realid"),j.attr("type"));break;case"folder":HROS.folderView.init(j);break;}return false;}var e=HROS.grid.searchFolderGrid(b,a);if(e!=null){if(j.attr("type")!="folder"){$.ajax({type:"POST",url:ajaxUrl,data:"ac=updateMyApp&movetype=desk-folder&id="+j.attr("realid")+"&type="+j.attr("type")+"&from="+(j.index()-2)+"&to="+e+"&desk="+HROS.CONFIG.desk,success:function(){j.remove();HROS.deskTop.appresize();if($("#qv_"+e).length!=0){HROS.folderView.init($("#d_folder_"+e));}if($("#w_folder_"+e).length!=0){HROS.window.updateFolder(e,"folder");}}});}}else{var o,p;var s=$("#desk-"+HROS.CONFIG.desk+" li.appbtn:not(.add)").length==0?-1:$("#desk-"+HROS.CONFIG.desk+" li").index(j);var n=$("#dock-bar .dock-applist").html()==""?-1:$("#dock-bar .dock-applist li").index(j);var q=HROS.CONFIG.dockPos=="left"?0:HROS.CONFIG.dockPos=="top"?($(window).width()-$("#dock-bar .dock-applist").width()-20)/2:$(window).width()-$("#dock-bar .dock-applist").width();var u=HROS.CONFIG.dockPos=="top"?0:($(window).height()-$("#dock-bar .dock-applist").height()-20)/2;p=HROS.grid.searchDockAppGrid(b-q,a-u);if(p!=null){$.ajax({type:"POST",url:ajaxUrl,data:"ac=updateMyApp&movetype=desk-dock&id="+j.attr("realid")+"&type="+j.attr("type")+"&from="+(j.index()-2)+"&to="+(p+1)+"&desk="+HROS.CONFIG.desk,success:function(){if(p<n){$("#dock-bar .dock-applist li:eq("+p+")").before(j);}else{if(p>n){$("#dock-bar .dock-applist li:eq("+p+")").after(j);}else{if(n==-1){$("#dock-bar .dock-applist").append(j);}}}if($("#dock-bar .dock-applist li").length>7){$("#desk-"+HROS.CONFIG.desk+" li.add").before($("#dock-bar .dock-applist li").last());}HROS.deskTop.appresize();}});}else{var m=HROS.CONFIG.dockPos=="left"?73:0;var r=HROS.CONFIG.dockPos=="top"?73:0;o=HROS.grid.searchAppGrid(b-m,a-r);if(o!=null&&o!=(j.index()-2)){$.ajax({type:"POST",url:ajaxUrl,data:"ac=updateMyApp&movetype=desk-desk&id="+j.attr("realid")+"&type="+j.attr("type")+"&from="+(j.index()-2)+"&to="+o+"&desk="+HROS.CONFIG.desk,success:function(){if(o<s){$("#desk-"+HROS.CONFIG.desk+" li:not(.add):eq("+o+")").before(j);}else{if(o>s){$("#desk-"+HROS.CONFIG.desk+" li:not(.add):eq("+o+")").after(j);}else{if(s==-1){$("#desk-"+HROS.CONFIG.desk+" li.add").before(j);}}}HROS.deskTop.appresize();}});}}}});}});$(".folder_body, .quick_view_container").off("mousedown","li").on("mousedown","li",function(f){f.preventDefault();f.stopPropagation();if(f.button==0||f.button==1){var j=$(this),h,g,b,a,k,i,d,c=$('<li id="shortcut_shadow">'+j.html()+"</li>");k=b=f.clientX;i=a=f.clientY;h=k-j.offset().left;g=i-j.offset().top;$(document).on("mousemove",function(m){$("body").append(c);d=HROS.maskBox.desk();d.show();b=m.clientX<=0?0:m.clientX>=$(document).width()?$(document).width():m.clientX;a=m.clientY<=0?0:m.clientY>=$(document).height()?$(document).height():m.clientY;_l=b-h;_t=a-g;if(k!=b||i!=a){c.css({left:_l,top:_t}).show();}}).on("mouseup",function(){$(document).off("mousemove").off("mouseup");c.remove();if(typeof(d)!=="undefined"){d.hide();}if(k==b&&i==a){switch(j.attr("type")){case"app":case"papp":HROS.window.create(j.attr("realid"),j.attr("type"));break;case"widget":case"pwidget":HROS.widget.create(j.attr("realid"),j.attr("type"));break;}return false;}var e=HROS.grid.searchFolderGrid(b,a);if(e!=null){if(j.parents(".folder-window").attr("realid")!=e){$.ajax({type:"POST",url:ajaxUrl,data:"ac=updateMyApp&movetype=folder-folder&id="+j.attr("realid")+"&type="+j.attr("type")+"&from="+j.parents(".folder-window").attr("realid")+"&to="+e+"&desk="+HROS.CONFIG.desk,success:function(){j.remove();HROS.deskTop.appresize();if($("#qv_"+e).length!=0){HROS.folderView.init($("#d_folder_"+e));}if($("#w_folder_"+e).length!=0){HROS.window.updateFolder(e,"folder");}}});}}else{var o,p;var s=$("#desk-"+HROS.CONFIG.desk+" li.appbtn:not(.add)").length==0?-1:$("#desk-"+HROS.CONFIG.desk+" li").index(j);var n=$("#dock-bar .dock-applist").html()==""?-1:$("#dock-bar .dock-applist li").index(j);var q=HROS.CONFIG.dockPos=="left"?0:HROS.CONFIG.dockPos=="top"?($(window).width()-$("#dock-bar .dock-applist").width()-20)/2:$(window).width()-$("#dock-bar .dock-applist").width();var u=HROS.CONFIG.dockPos=="top"?0:($(window).height()-$("#dock-bar .dock-applist").height()-20)/2;p=HROS.grid.searchDockAppGrid(b-q,a-u);if(p!=null){$.ajax({type:"POST",url:ajaxUrl,data:"ac=updateMyApp&movetype=folder-dock&id="+j.attr("realid")+"&type="+j.attr("type")+"&from="+j.parents(".folder-window").attr("realid")+"&to="+(p+1)+"&desk="+HROS.CONFIG.desk,success:function(){var v=j.parents(".folder-window").attr("realid");if(p<n){$("#dock-bar .dock-applist li.appbtn:not(.add):eq("+p+")").before(j);}else{if(p>n){$("#dock-bar .dock-applist li.appbtn:not(.add):eq("+p+")").after(j);}else{if(n==-1){$("#dock-bar .dock-applist").append(j);}}}if($("#dock-bar .dock-applist li").length>7){$("#desk-"+HROS.CONFIG.desk+" li.add").before($("#dock-bar .dock-applist li").last());}HROS.deskTop.appresize();if($("#qv_"+v).length!=0){HROS.folderView.init($("#d_folder_"+v));}if($("#w_folder_"+v).length!=0){HROS.window.updateFolder(v,"folder");}}});}else{var m=HROS.CONFIG.dockPos=="left"?73:0;var r=HROS.CONFIG.dockPos=="top"?73:0;o=HROS.grid.searchAppGrid(b-m,a-r);if(o!=null){$.ajax({type:"POST",url:ajaxUrl,data:"ac=updateMyApp&movetype=folder-desk&id="+j.attr("realid")+"&type="+j.attr("type")+"&from="+j.parents(".folder-window").attr("realid")+"&to="+(o+1)+"&desk="+HROS.CONFIG.desk,success:function(){var v=j.parents(".folder-window").attr("realid");if(o<s){$("#desk-"+HROS.CONFIG.desk+" li.appbtn:not(.add):eq("+o+")").before(j);}else{if(o>s){$("#desk-"+HROS.CONFIG.desk+" li.appbtn:not(.add):eq("+o+")").after(j);}else{if(s==-1){$("#desk-"+HROS.CONFIG.desk+" li.add").before(j);}}}HROS.deskTop.appresize();if($("#qv_"+v).length!=0){HROS.folderView.init($("#d_folder_"+v));}if($("#w_folder_"+v).length!=0){HROS.window.updateFolder(v,"folder");}}});}}}});}});},getScrollbar:function(){setTimeout(function(){$("#desk .desktop-container").each(function(){var b=$(this),d=b.children(".scrollbar");d.hide();b.scrollLeft(0).scrollTop(0);if(HROS.CONFIG.appXY=="x"){var a=parseInt(b.children(".add").css("top"))+108;if(b.height()/a<1){b.children(".scrollbar-y").height(b.height()/a*b.height()).css("top",0).show();}}else{var c=parseInt(b.children(".add").css("left"))+106;if(b.width()/c<1){b.children(".scrollbar-x").width(b.width()/c*b.width()).css("left",0).show();}}});},500);},moveScrollbar:function(){$(".scrollbar").on("mousedown",function(g){var i,h,d,b,c,m,j,f;var k=$(this),a=k.parent(".desktop-container");c=parseInt(a.children(".add").css("left"))+106;m=parseInt(a.children(".add").css("top"))+108;j=a.width()-k.width();f=a.height()-k.height();if(k.hasClass("scrollbar-x")){i=g.clientX-k.offset().left;}else{h=g.clientY-k.offset().top;}$(document).on("mousemove",function(n){if(k.hasClass("scrollbar-x")){if(HROS.CONFIG.dockPos=="left"){d=n.clientX-i-73<0?0:n.clientX-i-73>j?j:n.clientX-i-73;}else{d=n.clientX-i<0?0:n.clientX-i>j?j:n.clientX-i;}k.css("left",d/a.width()*c+d);a.scrollLeft(d/a.width()*c);}else{if(HROS.CONFIG.dockPos=="top"){b=n.clientY-h-73<0?0:n.clientY-h-73>f?f:n.clientY-h-73;}else{b=n.clientY-h<0?0:n.clientY-h>f?f:n.clientY-h;}k.css("top",b/a.height()*m+b);a.scrollTop(b/a.height()*m);}}).on("mouseup",function(){$(this).off("mousemove").off("mouseup");});});$("#desk .desktop-container").each(function(a){$("#desk-"+(a+1)).on("mousewheel",function(d,f){var b=$(this),e=parseInt(b.children(".add").css("top"))+108,c;if(f<0){c=b.scrollTop()+200>e-b.height()?e-b.height():b.scrollTop()+200;}else{c=b.scrollTop()-200<0?0:b.scrollTop()-200;}b.stop(false,true).animate({scrollTop:c},300);b.children(".scrollbar-y").stop(false,true).animate({top:c/e*b.height()+c},300);});});}};})();HROS.appmanage=(function(){return{init:function(){$("#amg_dock_container").html("").append($("#dock-container .dock-applist li").clone());$("#desk .desktop-container").each(function(a){$("#amg_folder_container .folderItem:eq("+a+") .folderInner").html("");$(this).children(".appbtn:not(.add)").each(function(){$("#amg_folder_container .folderItem:eq("+a+") .folderInner").append($(this).clone());});});$("#desktop").hide();$("#appmanage").show();$("#amg_folder_container .folderItem").show().addClass("folderItem_turn");$("#amg_folder_container").height($(document).height()-80);$("#appmanage .amg_close").off("click").on("click",function(){HROS.appmanage.close();});HROS.appmanage.appresize();HROS.appmanage.move();HROS.appmanage.getScrollbar();HROS.appmanage.moveScrollbar();},getScrollbar:function(){setTimeout(function(){$("#amg_folder_container .folderItem").each(function(){var a=$(this).find(".folderInner"),b=parseInt(a.children(".shortcut:last").css("top"))+41,c=a.next(".scrollBar");c.hide();a.scrollTop(0);if(a.height()/b<1){c.height(a.height()/b*a.height()).css("top",0).show();}});},500);},moveScrollbar:function(){$(".scrollBar").on("mousedown",function(d){var h,g,c,b;var f=$(this),a=f.prev(".folderInner");c=parseInt(a.children(".shortcut:last").css("top"))+41;b=a.height()-f.height();h=d.clientY-f.offset().top;$(document).on("mousemove",function(i){g=i.clientY-h-80<0?0:i.clientY-h-80>b?b:i.clientY-h-80;f.css("top",g);a.scrollTop(g/a.height()*c);}).on("mouseup",function(){$(this).off("mousemove").off("mouseup");});});$("#amg_folder_container .folderInner").off("mousewheel").on("mousewheel",function(c,e){var a=$(this),d=parseInt(a.children(".shortcut:last").css("top"))+41,b;if(e<0){b=a.scrollTop()+120>d-a.height()?d-a.height():a.scrollTop()+120;}else{b=a.scrollTop()-120<0?0:a.scrollTop()-120;}a.stop(false,true).animate({scrollTop:b},300);a.next(".scrollBar").stop(false,true).animate({top:b/d*a.height()},300);});},resize:function(){$("#amg_folder_container").height($(document).height()-80);HROS.appmanage.getScrollbar();},appresize:function(){var b=HROS.grid.getManageDockAppGrid();$("#amg_dock_container li").each(function(d){$(this).animate({"left":b[d]["startX"],"top":10},500);});for(var a=0;a<5;a++){var c=HROS.grid.getManageAppGrid();$("#amg_folder_container .folderItem:eq("+a+") .folderInner li").each(function(d){$(this).animate({"left":0,"top":c[d]["startY"]},500).attr("desk",a);});}},close:function(){$("#amg_dock_container").html("");$("#amg_folder_container .folderInner").html("");$("#desktop").show();$("#appmanage").hide();$("#amg_folder_container .folderItem").removeClass("folderItem_turn");HROS.app.get();},move:function(){$("#amg_dock_container").off("mousedown").on("mousedown","li",function(f){f.preventDefault();f.stopPropagation();if(f.button==0||f.button==1){var j=$(this),h,g,b,a,k,i,d,c=$('<li id="shortcut_shadow">'+j.html()+"</li>");k=b=f.clientX;i=a=f.clientY;h=k-j.offset().left;g=i-j.offset().top;$(document).on("mousemove",function(m){$("body").append(c);d=HROS.maskBox.desk();d.show();b=m.clientX<=0?0:m.clientX>=$(document).width()?$(document).width():m.clientX;a=m.clientY<=0?0:m.clientY>=$(document).height()?$(document).height():m.clientY;_l=b-h;_t=a-g;if(k!=b||i!=a){c.css({left:_l,top:_t}).show();}}).on("mouseup",function(){$(document).off("mousemove").off("mouseup");c.remove();if(typeof(d)!=="undefined"){d.hide();}if(k==b&&i==a){HROS.appmanage.close();switch(j.attr("type")){case"widget":case"pwidget":HROS.widget.create(j.attr("realid"),j.attr("type"));break;case"app":case"papp":case"folder":HROS.window.create(j.attr("realid"),j.attr("type"));break;}return false;}var n,e;var o=$("#amg_folder_container .folderItem:eq("+j.attr("desk")+") .folderInner li").length==0?-1:$("#amg_folder_container .folderItem:eq("+j.attr("desk")+") .folderInner li").index(j);var p=$("#amg_dock_container").html()==""?-1:$("#amg_dock_container li").index(j);if(a<=80){e=HROS.grid.searchManageDockAppGrid(b);if(e!=null&&e!=j.index()){$.ajax({type:"POST",url:ajaxUrl,data:"ac=updateMyApp&movetype=dock-dock&id="+j.attr("realid")+"&type="+j.attr("type")+"&from="+j.index()+"&to="+e+"&desk="+HROS.CONFIG.desk,success:function(){if(e<p){$("#amg_dock_container li:eq("+e+")").before(j);}else{if(e>p){$("#amg_dock_container li:eq("+e+")").after(j);}}HROS.appmanage.appresize();HROS.appmanage.getScrollbar();}});}}else{var m=parseInt(b/($(document).width()/5));n=HROS.grid.searchManageAppGrid(a-90,m);if(n!=null){$.ajax({type:"POST",url:ajaxUrl,data:"ac=updateMyApp&movetype=dock-desk&id="+j.attr("realid")+"&type="+j.attr("type")+"&from="+j.index()+"&to="+(n+1)+"&desk="+(m+1),success:function(){if(n<o){$("#amg_folder_container .folderItem:eq("+m+") .folderInner li:eq("+n+")").before(j);}else{if(n>o){$("#amg_folder_container .folderItem:eq("+m+") .folderInner li:eq("+n+")").after(j);}else{if(o==-1){$("#amg_folder_container .folderItem:eq("+m+") .folderInner").append(j);}}}HROS.appmanage.appresize();HROS.appmanage.getScrollbar();}});}}});}return false;});$("#amg_folder_container").off("mousedown","li.appbtn:not(.add)").on("mousedown","li.appbtn:not(.add)",function(f){f.preventDefault();f.stopPropagation();if(f.button==0||f.button==1){var j=$(this),h,g,b,a,k,i,d,c=$('<li id="shortcut_shadow2">'+j.html()+"</li>");k=b=f.clientX;i=a=f.clientY;h=k-j.offset().left;g=i-j.offset().top;$(document).on("mousemove",function(m){$("body").append(c);d=HROS.maskBox.desk();d.show();b=m.clientX<=0?0:m.clientX>=$(document).width()?$(document).width():m.clientX;a=m.clientY<=0?0:m.clientY>=$(document).height()?$(document).height():m.clientY;_l=b-h;_t=a-g;if(k!=b||i!=a){c.css({left:_l,top:_t}).show();}}).on("mouseup",function(){$(document).off("mousemove").off("mouseup");c.remove();if(typeof(d)!=="undefined"){d.hide();}if(k==b&&i==a){HROS.appmanage.close();switch(j.attr("type")){case"widget":case"pwidget":HROS.widget.create(j.attr("realid"),j.attr("type"));break;case"app":case"papp":case"folder":HROS.window.create(j.attr("realid"),j.attr("type"));break;}return false;}var n,e;var o=$("#amg_folder_container .folderItem:eq("+j.attr("desk")+") .folderInner li").length==0?-1:$("#amg_folder_container .folderItem:eq("+j.attr("desk")+") .folderInner li").index(j);var p=$("#amg_dock_container").html()==""?-1:$("#amg_dock_container li").index(j);if(a<=80){e=HROS.grid.searchManageDockAppGrid(b);if(e!=null){$.ajax({type:"POST",url:ajaxUrl,data:"ac=updateMyApp&movetype=desk-dock&id="+j.attr("realid")+"&type="+j.attr("type")+"&from="+j.index()+"&to="+(e+1)+"&desk="+(parseInt(j.attr("desk"))+1),success:function(){if(e<p){$("#amg_dock_container li:eq("+e+")").before(j);}else{if(e>p){$("#amg_dock_container li:eq("+e+")").after(j);}else{if(p==-1){$("#amg_dock_container").append(j);}}}if($("#amg_dock_container li.shortcut").length>7){if($("#amg_folder_container .folderItem:eq("+j.attr("desk")+") .folderInner li").length==0){$("#amg_folder_container .folderItem:eq("+j.attr("desk")+") .folderInner").append($("#amg_dock_container li").last());}else{$("#amg_folder_container .folderItem:eq("+j.attr("desk")+") .folderInner li").last().after($("#amg_dock_container li").last());}}HROS.appmanage.appresize();HROS.appmanage.getScrollbar();}});}}else{var m=parseInt(b/($(document).width()/5));n=HROS.grid.searchManageAppGrid(a-90,m);if(n!=null){if(m==j.attr("desk")){$.ajax({type:"POST",url:ajaxUrl,data:"ac=updateMyApp&movetype=desk-desk&id="+j.attr("realid")+"&type="+j.attr("type")+"&from="+j.index()+"&to="+n+"&desk="+(m+1),success:function(){if(n<o){$("#amg_folder_container .folderItem:eq("+m+") .folderInner li:eq("+n+")").before(j);}else{if(n>o){$("#amg_folder_container .folderItem:eq("+m+") .folderInner li:eq("+n+")").after(j);}else{if(o==-1){$("#amg_folder_container .folderItem:eq("+m+") .folderInner").append(j);}}}HROS.appmanage.appresize();HROS.appmanage.getScrollbar();}});}else{$.ajax({type:"POST",url:ajaxUrl,data:"ac=updateMyApp&movetype=desk-otherdesk&id="+j.attr("realid")+"&type="+j.attr("type")+"&from="+j.index()+"&to="+n+"&desk="+(parseInt(j.attr("desk"))+1)+"&otherdesk="+(m+1),success:function(){if(n!=-1){$("#amg_folder_container .folderItem:eq("+m+") .folderInner li:eq("+n+")").before(j);}else{$("#amg_folder_container .folderItem:eq("+m+") .folderInner").append(j);}HROS.appmanage.appresize();HROS.appmanage.getScrollbar();}});}}}});}return false;});}};})();HROS.base=(function(){return{init:function(){if(!$.browser.msie){window.onbeforeunload=Util.confirmExit;}$("#desktop").on("click",function(){$(".popup-menu").hide();$(".quick_view_container").remove();});$("body").on("contextmenu",function(){$(".popup-menu").hide();return false;});HROS.base.resize();HROS.zoom.init();HROS.wallpaper.get(function(){HROS.wallpaper.set();});HROS.navbar.init();HROS.taskbar.init();HROS.dock.getPos(function(){HROS.app.getXY(function(){HROS.app.get();});});$(".dock-tool-pinyin").on("mousedown",function(){return false;}).on("click",function(){javascript:(function(a){a?a.toggle():function(c,b){b=c.createElement("script");b.async=true;b.src="//ime.qq.com/fcgi-bin/getjs";b.setAttribute("ime-cfg","lt=2");c=c.getElementsByTagName("head")[0];c.insertBefore(b,c.firstChild);}(document);})(window.QQWebIME);});$(".dock-tool-style").on("mousedown",function(){return false;}).on("click",function(){HROS.window.createTemp({id:"ztsz",title:"主题设置",url:"sysapp/wallpaper/index.php",width:580,height:520,isresize:false,isflash:false});});$("#desk").on("contextmenu",function(b){$(".popup-menu").hide();$(".quick_view_container").remove();var a=HROS.popupMenu.desk();l=($(document).width()-b.clientX)<a.width()?(b.clientX-a.width()):b.clientX;t=($(document).height()-b.clientY)<a.height()?(b.clientY-a.height()):b.clientY;a.css({left:l,top:t}).show();return false;});HROS.widget.reduction();HROS.base.help();(function(a){a["lock"]=true;a["fixed"]=true;a["resize"]=false;a["background"]="#000";a["opacity"]=0.5;})($.dialog.defaults);},logout:function(){$.ajax({type:"POST",url:ajaxUrl,data:"ac=logout",success:function(){location.href="login.php";}});},resize:function(){$(window).on("resize",function(){HROS.deskTop.resize(200);});},getSkin:function(){$.ajax({type:"POST",url:ajaxUrl,data:"ac=getSkin",success:function(b){$("#window-skin").remove();var a=document.createElement("link");a.rel="stylesheet";a.href="img/skins/"+b+".css?"+version;a.id="window-skin";$("body").append(a);}});},help:function(){if($.cookie("isLoginFirst")==null){$.cookie("isLoginFirst","1",{expires:95});if(!$.browser.msie||($.browser.msie&&$.browser.version<9)){$("body").append(helpTemp);$("#step1").show();$(".close").on("click",function(){$("#help").remove();});$(".next").on("click",function(){var b=$(this).parents(".step");var a=b.attr("step");b.hide();$("#step"+(parseInt(a)+1)).show();});$(".over").on("click",function(){$("#help").remove();});}}}};})();HROS.deskTop=(function(){return{resize:function(a){$.doTimeout("resize",a,function(){console.log(1);if($("#desktop").css("display")!=="none"){HROS.dock.setPos();HROS.deskTop.appresize();HROS.deskTop.windowresize();HROS.app.getScrollbar();}else{HROS.appmanage.resize();}HROS.wallpaper.set(false);});},appresize:function(){var b=HROS.grid.getAppGrid(),c=HROS.grid.getDockAppGrid();$("#dock-bar .dock-applist li").each(function(d){$(this).animate({"left":c[d]["startX"],"top":c[d]["startY"]},500);});for(var a=1;a<=5;a++){$("#desk-"+a+" li").each(function(d){$(this).animate({"left":b[d]["startX"]+16,"top":b[d]["startY"]+7},500);});}},windowresize:function(){$("#desk div.window-container").each(function(){var a=$(this).data("info");currentW=$(window).width()-$(this).width();currentH=$(window).height()-$(this).height();_l=a["left"]/a["emptyW"]*currentW>=currentW?currentW:a["left"]/a["emptyW"]*currentW;_l=_l<=0?0:_l;_t=a["top"]/a["emptyH"]*currentH>=currentH?currentH:a["top"]/a["emptyH"]*currentH;_t=_t<=0?0:_t;$(this).animate({"left":_l,"top":_t},500);});}};})();HROS.dock=(function(){return{getPos:function(a){$.ajax({type:"POST",url:ajaxUrl,data:"ac=getDockPos",success:function(b){HROS.CONFIG.dockPos=b;HROS.dock.setPos();if(typeof(a)!="undefined"){a();}}});},setPos:function(){var d=$("#desk-"+HROS.CONFIG.desk),b=$("#desk .desktop-container");var a=d.css("width","100%").width(),c=d.css("height","100%").height();$("#dock-container").removeClass("dock-top").removeClass("dock-left").removeClass("dock-right");$("#dock-bar").removeClass("top-bar").removeClass("left-bar").removeClass("right-bar").hide();if(HROS.CONFIG.dockPos=="top"){$("#dock-bar").addClass("top-bar").children("#dock-container").addClass("dock-top");b.css({"width":a,"height":c-143,"left":a,"top":73});d.css({"left":0});}else{if(HROS.CONFIG.dockPos=="left"){$("#dock-bar").addClass("left-bar").children("#dock-container").addClass("dock-left");b.css({"width":a-73,"height":c-70,"left":a+73,"top":0});d.css({"left":73});}else{if(HROS.CONFIG.dockPos=="right"){$("#dock-bar").addClass("right-bar").children("#dock-container").addClass("dock-right");b.css({"width":a-73,"height":c-70,"left":a,"top":0});d.css({"left":0});}}}$("#dock-bar").show();HROS.taskbar.resize();},updatePos:function(b,a){$.ajax({type:"POST",url:ajaxUrl,data:"ac=setDockPos&dock="+b,success:function(){HROS.CONFIG.dockPos=b;if(typeof(a)!="undefined"){a();}}});},move:function(){$("#dock-container").off("mousedown").on("mousedown",function(c){if(c.button==0||c.button==1){var b=HROS.maskBox.dock(),a;$(document).on("mousemove",function(d){b.show();if(d.clientY<b.height()*0.2){a="top";}else{if(d.clientX<b.width()*0.5){a="left";}else{a="right";}}$(".dock_drap_effect").removeClass("hover");$(".dock_drap_effect_"+a).addClass("hover");}).on("mouseup",function(){$(document).off("mousemove").off("mouseup");b.hide();if(a!=HROS.CONFIG.dockPos&&typeof(a)!="undefined"){HROS.dock.updatePos(a,function(){HROS.dock.setPos();HROS.deskTop.appresize();HROS.app.getScrollbar();});}});}});}};})();HROS.folderView=(function(){return{init:function(b){var a="";$.getJSON(ajaxUrl+"?ac=getMyFolderApp&folderid="+b.attr("realid"),function(j){var c=0;if(j!=null){for(var e=0;e<j.length;e++){switch(j[e]["type"]){case"app":case"widget":case"papp":case"pwidget":a+=appbtnTemp({"top":0,"left":0,"title":j[e]["name"],"type":j[e]["type"],"id":"d_"+j[e]["type"]+"_"+j[e]["id"],"realid":j[e]["id"],"imgsrc":j[e]["icon"]});break;}}if(j.length%4==0){c+=Math.floor(j.length/4)*60;}else{c+=(Math.floor(j.length/4)+1)*60;}}else{a="文件夹为空";c+=30;}var h,g;if(b.parent("div").hasClass("dock-applist")){h=b.offset().left+60;g=b.offset().top;}else{h=b.offset().left+80;g=b.offset().top-20;}var d=false;if(c+g+46>$(document).height()){var f=c+g+46-$(document).height();if(f<=g){g-=f;}else{c-=f-g;g=0;d=true;}}$(".quick_view_container").remove();if(h+340>$(document).width()){$("body").append(folderViewTemp({"id":"qv_"+b.attr("realid"),"realid":b.attr("realid"),"apps":a,"top":g,"left":h-340-80,"height":c,"mlt":Math.ceil((c+26)/2),"mlm":false,"mlb":Math.ceil((c+26)/2),"mrt":b.offset().top-g,"mrm":true,"mrb":c+26-(b.offset().top-g)-20}));}else{$("body").append(folderViewTemp({"id":"qv_"+b.attr("realid"),"realid":b.attr("realid"),"apps":a,"top":g,"left":h,"height":c,"mlt":b.offset().top-g,"mlm":true,"mlb":c+26-(b.offset().top-g)-20,"mrt":Math.ceil((c+26)/2),"mrm":false,"mrb":Math.ceil((c+26)/2)}));}$("body").on("contextmenu",".appbtn:not(.add)",function(m){$(".popup-menu").hide();TEMP.AppRight=HROS.popupMenu.app($(this));var i=($(document).width()-m.clientX)<TEMP.AppRight.width()?(m.clientX-TEMP.AppRight.width()):m.clientX;var k=($(document).height()-m.clientY)<TEMP.AppRight.height()?(m.clientY-TEMP.AppRight.height()):m.clientY;TEMP.AppRight.css({left:i,top:k}).show();return false;});$(".quick_view_container_open").on("click",function(){HROS.window.create($(this).parents(".quick_view_container").attr("realid"),"folder");$("#quick_view_container_"+$(this).parents(".quick_view_container").attr("realid")).remove();});HROS.folderView.getScrollbar(b.attr("realid"),d);HROS.folderView.moveScrollbar(b.attr("realid"));HROS.app.move();});},getScrollbar:function(d,b){var a="#quick_view_container_list_in_"+d;var c="#quick_view_container_list_"+d+" .scrollBar";if(b){$("#quick_view_container_list_"+d+" .scrollBar_bgc").show();$(c).show().height($(a).height()/(Math.ceil($(a).children().length/4)*60)*$(a).height());}else{$("#quick_view_container_list_"+d+" .scrollBar_bgc").hide();$(c).hide().height(0);}},moveScrollbar:function(c){var a="#quick_view_container_list_in_"+c;var b="#quick_view_container_list_"+c+" .scrollBar";$(b).on("mousedown",function(i){var g=$("#quick_view_container_"+c).offset().top+36;var m,k,h,f;var j=$(this),d=$(a);h=Math.ceil($(a).children().length/4)*60;f=d.height()-j.height();m=i.clientY-j.offset().top;$(document).on("mousemove",function(n){k=n.clientY-m-g<0?0:n.clientY-m-g>f?f:n.clientY-m-g;j.css("top",k);d.scrollTop(k/d.height()*h);}).on("mouseup",function(){$(this).off("mousemove").off("mouseup");});});$(a).off("mousewheel").on("mousewheel",function(f,h){var d=$(this),g=Math.ceil($(a).children().length/4)*60,e;if(h<0){e=d.scrollTop()+40>g-d.height()?g-d.height():d.scrollTop()+40;}else{e=d.scrollTop()-40<0?0:d.scrollTop()-40;}d.stop(false,true).animate({scrollTop:e},300);$(b).stop(false,true).animate({top:e/g*d.height()},300);});}};})();HROS.grid=(function(){return{getAppGrid:function(){var d,a;d=$("#desk-"+HROS.CONFIG.desk).width()-HROS.CONFIG.appButtonLeft;a=$("#desk-"+HROS.CONFIG.desk).height()-HROS.CONFIG.appButtonTop;var b=[],f=HROS.CONFIG.appButtonTop,e=HROS.CONFIG.appButtonLeft;for(var c=0;c<10000;c++){b.push({startY:f,endY:f+100,startX:e,endX:e+120});if(HROS.CONFIG.appXY=="x"){e+=120;if(e+100>d){f+=100;e=HROS.CONFIG.appButtonLeft;}}else{f+=100;if(f+70>a){f=HROS.CONFIG.appButtonTop;e+=120;}}}return b;},searchAppGrid:function(a,g){var f=HROS.grid.getAppGrid(),d=f.length;var b=0,c=$("#desk-"+HROS.CONFIG.desk+" li.appbtn:not(.add)").length-1;for(var e=0;e<d;e++){if(a>=f[e].startX&&a<=f[e].endX){b+=1;}if(g>=f[e].startY&&g<=f[e].endY){b+=1;}if(b===2){return e>c?c:e;}else{b=0;}}return null;},getDockAppGrid:function(){var a=$("#dock-bar .dock-applist").height();var d=[],c=0,e=0;for(var b=0;b<7;b++){d.push({startY:e,endY:e+62,startX:c,endX:c+62});e+=62;if(e+62>a){e=0;c+=62;}}return d;},searchDockAppGrid:function(a,g){var f=HROS.grid.getDockAppGrid(),d=f.length,b=0,c=$("#dock-bar .dock-applist li").length-1;for(var e=0;e<d;e++){if(a>=f[e].startX&&a<=f[e].endX){b+=1;}if(g>=f[e].startY&&g<=f[e].endY){b+=1;}if(b===2){return e>c?c:e;}else{b=0;}}return null;},getFolderGrid:function(){var a=[];$(".folder-window:visible").each(function(){a.push({zIndex:$(this).css("z-index"),id:$(this).attr("realid"),startY:$(this).offset().top,endY:$(this).offset().top+$(this).height(),startX:$(this).offset().left,endX:$(this).offset().left+$(this).width()});});a.sort(function(b,c){return c["zIndex"]-b["zIndex"];});return a;},searchFolderGrid:function(a,f){var e=HROS.grid.getFolderGrid(),c=e.length,b=0;for(var d=0;d<c;d++){if(a>=e[d].startX&&a<=e[d].endX){b+=1;}if(f>=e[d].startY&&f<=e[d].endY){b+=1;}if(b===2){return e[d]["id"];}else{b=0;}}return null;},getManageDockAppGrid:function(){var a=[],c=20;for(var b=0;b<7;b++){a.push({startX:c,endX:c+72});c+=72;}return a;},searchManageDockAppGrid:function(a){var f=HROS.grid.getManageDockAppGrid(),d=f.length,b=0,c=$("#amg_dock_container li").length-1;for(var e=0;e<d;e++){if(a>=f[e].startX&&a<=f[e].endX){b+=1;}if(b===1){return e>c?c:e;}else{b=0;}}return null;},getManageAppGrid:function(){var b=[],c=0;for(var a=0;a<10000;a++){b.push({startY:c,endY:c+40});c+=40;}return b;},searchManageAppGrid:function(g,b){var f=HROS.grid.getManageAppGrid(),d=f.length,a=0,c=$("#amg_folder_container .folderItem:eq("+b+") .folderInner li").length-1;for(var e=0;e<d;e++){if(g>=f[e].startY&&g<=f[e].endY){a+=1;}if(a===1){return e>c?c:e;}else{a=0;}}return null;}};})();HROS.maskBox=(function(){return{desk:function(){if(!TEMP.maskBoxDesk){TEMP.maskBoxDesk=$('<div id="maskbox"></div>');$("body").append(TEMP.maskBoxDesk);}return TEMP.maskBoxDesk;},dock:function(){if(!TEMP.maskBoxDock){TEMP.maskBoxDock=$('<div style="z-index:1000000003;display:block;cursor:default;background:none;width:100%;height:100%;position:absolute;top:0;left:0"><div id="docktop" class="dock_drap_effect dock_drap_effect_top"></div><div id="dockleft" class="dock_drap_effect dock_drap_effect_left"></div><div id="dockright" class="dock_drap_effect dock_drap_effect_right"></div><div id="dockmask" class="dock_drap_mask"><div class="dock_drop_region_top"></div><div class="dock_drop_region_left"></div><div class="dock_drop_region_right"></div></div></div>');$("body").append(TEMP.maskBoxDock);}return TEMP.maskBoxDock;}};})();HROS.navbar=(function(){return{init:function(){$("#nav-bar").css({"left":$(document).width()/2-105,"top":80}).show();HROS.navbar.move();HROS.navbar.deskSwitch();},move:function(){$("#nav-bar").on("mousedown",function(f){if(f.button==0||f.button==1){var b,h,a,g,c,d=$("#nav-bar");b=f.clientX-d.offset().left;h=f.clientY-d.offset().top;$(document).on("mousemove",function(i){c=HROS.maskBox.desk();c.show();a=i.clientX-b<=0?0:i.clientX-b>$(document).width()-210?$(document).width()-210:i.clientX-b;g=i.clientY-h<=10?10:i.clientY-h>$(document).height()-50?$(document).height()-50:i.clientY-h;d.css({left:a,top:g});}).on("mouseup",function(){if(typeof(c)!=="undefined"){c.hide();}$(this).off("mousemove").off("mouseup");});}});},deskSwitch:function(){$("#nav-bar .nav-container").on("mousedown","a.indicator",function(g){$(".popup-menu").hide();$(".quick_view_container").remove();if(g.button==0||g.button==1){var i,h,c,b,k,j,f,d=$("#nav-bar"),a=$(this);k=c=d.offset().left;j=b=d.offset().top;i=g.clientX-k;h=g.clientY-j;$(document).on("mousemove",function(m){f=HROS.maskBox.desk();f.show();c=m.clientX-i<=0?0:m.clientX-i>$(document).width()-210?$(document).width()-210:m.clientX-i;b=m.clientY-h<=10?10:m.clientY-h>$(document).height()-50?$(document).height()-50:m.clientY-h;d.css({left:c,top:b});}).on("mouseup",function(){if(k==c&&j==b){if(typeof(a.attr("index"))!=="undefined"){var o=$("#navContainer"),e=HROS.CONFIG.desk,n=a.attr("index"),m=$("#desk-"+e).offset().left,p=$("#desk-"+n).offset().left;if(e!=n){if(!$("#desk-"+n).hasClass("animated")&&!$("#desk-"+e).hasClass("animated")){$("#desk-"+e).addClass("animated").animate({left:p},500,"easeInOutCirc",function(){$(this).removeClass("animated");});$("#desk-"+n).addClass("animated").animate({left:m},500,"easeInOutCirc",function(){$(this).removeClass("animated");o.removeClass("nav-current-"+e).addClass("nav-current-"+n);HROS.CONFIG.desk=n;});}}}else{HROS.appmanage.init();}}if(typeof(f)!=="undefined"){f.hide();}$(this).off("mousemove").off("mouseup");});}});}};})();HROS.popupMenu=(function(){return{app:function(a){if(!TEMP.popupMenuApp){TEMP.popupMenuApp=$('<div class="popup-menu app-menu" style="z-index:9990;display:none"><ul><li style="border-bottom:1px solid #F0F0F0"><a menu="open" href="javascript:;">打开应用</a></li><li><a menu="move" href="javascript:;">移动应用到<b class="arrow">»</b></a><div class="popup-menu" style="display:none"><ul><li><a menu="moveto" desk="1" href="javascript:;">桌面1</a></li><li><a menu="moveto" desk="2" href="javascript:;">桌面2</a></li><li><a menu="moveto" desk="3" href="javascript:;">桌面3</a></li><li><a menu="moveto" desk="4" href="javascript:;">桌面4</a></li><li><a menu="moveto" desk="5" href="javascript:;">桌面5</a></li></ul></div></li><li><b class="uninstall"></b><a menu="del" href="javascript:;">卸载应用</a></li></ul></div>');$("body").append(TEMP.popupMenuApp);$(".app-menu").on("contextmenu",function(){return false;});}$('.app-menu a[menu="moveto"]').removeClass("disabled");if(a.parent().hasClass("desktop-container")){$('.app-menu a[menu="moveto"]').each(function(){if($(this).attr("desk")==HROS.CONFIG.desk){$(this).addClass("disabled");}});}$(".app-menu li").off("mouseover").off("mouseout").on("mouseover",function(){if($(this).children("a").attr("menu")=="move"){$(this).children("a").addClass("focus");if($(document).width()-$(".app-menu").offset().left>250){$(this).children("div").css({left:122,top:-2});}else{$(this).children("div").css({left:-126,top:-2});}$(this).children("div").show();}}).on("mouseout",function(){$(this).children("a").removeClass("focus");$(this).children("div").hide();});$('.app-menu a[menu="moveto"]').off("click").on("click",function(){var b=$(this).attr("desk");$.ajax({type:"POST",url:ajaxUrl,data:"ac=moveMyApp&id="+a.attr("realid")+"&type="+a.attr("type")+"&todesk="+b,success:function(){$("#desk-"+b+" li.add").before(a);HROS.deskTop.appresize();HROS.app.getScrollbar();}});$(".popup-menu").hide();});$('.app-menu a[menu="open"]').off("click").on("click",function(){HROS.window.create(a.attr("realid"),a.attr("type"));$(".task-menu").hide();});$('.app-menu a[menu="del"]').off("click").on("click",function(){HROS.app.remove(a.attr("realid"),a.attr("type"),function(){a.find("img, span").show().animate({opacity:"toggle",width:0,height:0},500,function(){a.remove();HROS.deskTop.resize(250);});});$(".popup-menu").hide();});return TEMP.popupMenuApp;},papp:function(a){if(!TEMP.popupMenuApp){TEMP.popupMenuApp=$('<div class="popup-menu papp-menu" style="z-index:9990;display:none"><ul><li style="border-bottom:1px solid #F0F0F0"><a menu="open" href="javascript:;">打开应用</a></li><li><a menu="move" href="javascript:;">移动应用到<b class="arrow">»</b></a><div class="popup-menu" style="display:none"><ul><li><a menu="moveto" desk="1" href="javascript:;">桌面1</a></li><li><a menu="moveto" desk="2" href="javascript:;">桌面2</a></li><li><a menu="moveto" desk="3" href="javascript:;">桌面3</a></li><li><a menu="moveto" desk="4" href="javascript:;">桌面4</a></li><li><a menu="moveto" desk="5" href="javascript:;">桌面5</a></li></ul></div></li><li><b class="edit"></b><a menu="edit" href="javascript:;">编辑</a></li><li><b class="del"></b><a menu="del" href="javascript:;">删除应用</a></li></ul></div>');$("body").append(TEMP.popupMenuApp);$(".papp-menu").on("contextmenu",function(){return false;});}$('.papp-menu a[menu="moveto"]').removeClass("disabled");if(a.parent().hasClass("desktop-container")){$('.papp-menu a[menu="moveto"]').each(function(){if($(this).attr("desk")==HROS.CONFIG.desk){$(this).addClass("disabled");}});}$(".papp-menu li").off("mouseover").off("mouseout").on("mouseover",function(){if($(this).children("a").attr("menu")=="move"){$(this).children("a").addClass("focus");if($(document).width()-$(".papp-menu").offset().left>250){$(this).children("div").css({left:122,top:-2});}else{$(this).children("div").css({left:-126,top:-2});}$(this).children("div").show();}}).on("mouseout",function(){$(this).children("a").removeClass("focus");$(this).children("div").hide();});$('.papp-menu a[menu="moveto"]').off("click").on("click",function(){var b=$(this).attr("desk");$.ajax({type:"POST",url:ajaxUrl,data:"ac=moveMyApp&id="+a.attr("realid")+"&type="+a.attr("type")+"&todesk="+b,success:function(){$("#desk-"+b+" li.add").before(a);HROS.deskTop.appresize();HROS.app.getScrollbar();}});$(".popup-menu").hide();});$('.papp-menu a[menu="open"]').off("click").on("click",function(){switch(a.attr("type")){case"papp":HROS.window.create(a.attr("realid"),a.attr("type"));break;case"pwidget":HROS.widget.create(a.attr("realid"),a.attr("type"));break;}$(".popup-menu").hide();});$('.papp-menu a[menu="edit"]').off("click").on("click",function(){function b(c){$.dialog({id:"addfolder",title:"编辑私人应用“"+c.title+"”",padding:0,content:editPappDialogTemp({"id":c.id,"name":c.title,"url":c.url,"width":c.width,"height":c.height}),ok:function(){var f=$("#addpappName").val(),e=$("#addpappUrl").val(),g=$("#addpappWidth").val(),d=$("#addpappHeight").val();if(f!=""&&e!=""&&g!=""&&d!=""){$.ajax({type:"POST",url:ajaxUrl,data:"ac=updatePapp&name="+f+"&url="+e+"&width="+g+"&height="+d+"&id="+c.id,success:function(h){HROS.app.get();}});}else{alert("信息填写不完整");}},cancel:true});}ZENG.msgbox.show("数据读取中，请耐心等待...",6,100000);$.getJSON(ajaxUrl+"?ac=getMyAppById&id="+a.attr("realid")+"&type="+a.attr("type"),function(c){if(c!=null){ZENG.msgbox._hide();switch(c["type"]){case"papp":case"pwidget":b({id:c["id"],title:c["name"],url:c["url"],width:c["width"],height:c["height"],});break;}}else{ZENG.msgbox.show("数据拉取失败",5,2000);return false;}});$(".popup-menu").hide();});$('.papp-menu a[menu="del"]').off("click").on("click",function(){HROS.app.remove(a.attr("realid"),a.attr("type"),function(){a.find("img, span").show().animate({opacity:"toggle",width:0,height:0},500,function(){a.remove();HROS.deskTop.resize(250);});});$(".popup-menu").hide();});return TEMP.popupMenuApp;},folder:function(a){if(!TEMP.popupMenuFolder){TEMP.popupMenuFolder=$('<div class="popup-menu folder-menu" style="z-index:9990;display:none"><ul><li><a menu="view" href="javascript:;">预览</a></li><li style="border-bottom:1px solid #F0F0F0"><a menu="open" href="javascript:;">打开</a></li><li><b class="edit"></b><a menu="rename" href="javascript:;">重命名</a></li><li><b class="del"></b><a menu="del" href="javascript:;">删除</a></li></ul></div>');$("body").append(TEMP.popupMenuFolder);$(".folder-menu").on("contextmenu",function(){return false;});}$('.folder-menu a[menu="view"]').off("click").on("click",function(){HROS.folderView.init(a);$(".popup-menu").hide();});$('.folder-menu a[menu="open"]').off("click").on("click",function(){HROS.window.create(a.attr("realid"),a.attr("type"));$(".popup-menu").hide();});$('.folder-menu a[menu="del"]').off("click").on("click",function(){$.dialog({id:"delfolder",title:"删除“"+a.find("span").text()+"”文件夹",content:"删除文件夹的同时会删除文件夹内所有应用",icon:"warning",ok:function(){HROS.app.remove(a.attr("realid"),a.attr("type"),function(){a.find("img, span").show().animate({opacity:"toggle",width:0,height:0},500,function(){a.remove();HROS.deskTop.resize(250);});});},cancel:true});$(".popup-menu").hide();});$('.folder-menu a[menu="rename"]').off("click").on("click",function(){$.dialog({id:"addfolder",title:"重命名“"+a.find("span").text()+"”文件夹",padding:0,content:editFolderDialogTemp({"name":a.find("span").text(),"src":a.find("img").attr("src")}),ok:function(){if($("#folderName").val()!=""){$.ajax({type:"POST",url:ajaxUrl,data:"ac=updateFolder&name="+$("#folderName").val()+"&icon="+$(".folderSelector img").attr("src")+"&id="+a.attr("realid"),success:function(){HROS.app.get();}});}else{$(".folderNameError").show();return false;}},cancel:true});$(".folderSelector").off("click").on("click",function(){$(".fcDropdown").show();});$(".fcDropdown_item").off("click").on("click",function(){$(".folderSelector img").attr("src",$(this).children("img").attr("src")).attr("idx",$(this).children("img").attr("idx"));$(".fcDropdown").hide();});$(".popup-menu").hide();});return TEMP.popupMenuFolder;},task:function(a){if(!TEMP.popupMenuTask){TEMP.popupMenuTask=$('<div class="popup-menu task-menu" style="z-index:9990;display:none"><ul><li><a menu="max" href="javascript:;">最大化</a></li><li style="border-bottom:1px solid #F0F0F0"><a menu="hide" href="javascript:;">最小化</a></li><li><a menu="close" href="javascript:;">关闭</a></li></ul></div>');$("body").append(TEMP.popupMenuTask);$(".task-menu").on("contextmenu",function(){return false;});}$('.task-menu a[menu="max"]').off("click").on("click",function(){HROS.window.max(a.attr("realid"),a.attr("type"));$(".popup-menu").hide();});$('.task-menu a[menu="hide"]').off("click").on("click",function(){HROS.window.hide(a.attr("realid"),a.attr("type"));$(".popup-menu").hide();});$('.task-menu a[menu="close"]').off("click").on("click",function(){HROS.window.close(a.attr("realid"),a.attr("type"));$(".popup-menu").hide();});return TEMP.popupMenuTask;},desk:function(){if(!TEMP.popupMenuDesk){TEMP.popupMenuDesk=$('<div class="popup-menu desk-menu" style="z-index:9990;display:none"><ul><li><a menu="hideall" href="javascript:;">显示桌面</a></li><li><b class="refresh"></b><a menu="refresh" href="javascript:;">刷新</a></li><li style="border-bottom:1px solid #F0F0F0"><a menu="closeall" href="javascript:;">关闭所有应用</a></li><li><a href="javascript:;">新建<b class="arrow">»</b></a><div class="popup-menu" style="display:none"><ul><li><b class="folder"></b><a menu="addfolder" href="javascript:;">新建文件夹</a></li><li><b class="customapp"></b><a menu="addpapp" href="javascript:;">新建私人应用</a></li></ul></div></li><!--li style="border-bottom:1px solid #F0F0F0"><b class="upload"></b><a menu="uploadfile" href="javascript:;">上传文件</a></li--><li><b class="themes"></b><a menu="themes" href="javascript:;">主题设置</a></li><li><b class="setting"></b><a menu="setting" href="javascript:;">桌面设置</a></li><li style="border-bottom:1px solid #F0F0F0"><a href="javascript:;">图标设置<b class="arrow">»</b></a><div class="popup-menu" style="display:none"><ul><li><b class="hook"></b><a menu="orderby" orderby="x" href="javascript:;">横向排列</a></li><li><b class="hook"></b><a menu="orderby" orderby="y" href="javascript:;">纵向排列</a></li></ul></div></li><li><a menu="logout" href="javascript:;">注销</a></li></ul></div>');$("body").append(TEMP.popupMenuDesk);$(".desk-menu").on("contextmenu",function(){return false;});$(".desk-menu li").off("mouseover").off("mouseout").on("mouseover",function(){if($(this).children("a").next()!=""){$(this).children("a").addClass("focus");if($(document).width()-$(".desk-menu").offset().left>250){$(this).children("div").css({left:122,top:-2});}else{$(this).children("div").css({left:-126,top:-2});}$(this).children("div").show();}}).on("mouseout",function(){$(this).children("a").removeClass("focus");$(this).children("div").hide();});$('.desk-menu a[menu="orderby"]').off("click").on("click",function(){var a=$(this).attr("orderby");if(HROS.CONFIG.appXY!=a){HROS.app.updateXY(a,function(){HROS.deskTop.appresize();HROS.app.getScrollbar();});}$(".popup-menu").hide();});$('.desk-menu a[menu="refresh"]').on("click",function(){HROS.app.get();$(".popup-menu").hide();});$('.desk-menu a[menu="hideall"]').on("click",function(){HROS.window.hideAll();$(".popup-menu").hide();});$('.desk-menu a[menu="closeall"]').on("click",function(){HROS.window.closeAll();$(".popup-menu").hide();});$('.desk-menu a[menu="addfolder"]').on("click",function(){$.dialog({id:"addfolder",title:"新建文件夹",padding:0,content:editFolderDialogTemp({"name":"新建文件夹","src":"img/ui/folder_default.png"}),ok:function(){if($("#folderName").val()!=""){$.ajax({type:"POST",url:ajaxUrl,data:"ac=addFolder&name="+$("#folderName").val()+"&icon="+$(".folderSelector img").attr("src"),success:function(a){$.ajax({type:"POST",url:ajaxUrl,data:"ac=addMyApp&id="+a+"&type=folder&desk="+HROS.CONFIG.desk,success:function(){HROS.app.get();}});}});}else{$(".folderNameError").show();return false;}},cancel:true});$(".folderSelector").off("click").on("click",function(){$(".fcDropdown").show();});$(".fcDropdown_item").off("click").on("click",function(){$(".folderSelector img").attr("src",$(this).children("img").attr("src")).attr("idx",$(this).children("img").attr("idx"));$(".fcDropdown").hide();});$(".popup-menu").hide();});$('.desk-menu a[menu="addpapp"]').on("click",function(){$.dialog({id:"addpapp",title:"新建私人应用",padding:0,content:editPappDialogTemp({"width":600,"height":400,"type":"papp","isresize":1}),ok:function(){var d=$("#addpappName").val(),c=$("#addpappUrl").val(),f=$("#addpappWidth").val(),a=$("#addpappHeight").val(),e=$('#addpapp input[name="addpappType"]:checked').val(),b=$('#addpapp input[name="addpappIsresize"]:checked').val();if(d!=""&&c!=""&&f!=""&&a!=""){$.ajax({type:"POST",url:ajaxUrl,data:"ac=addPapp&name="+d+"&url="+c+"&width="+f+"&height="+a+"&type="+e+"&isresize="+b,success:function(g){$.ajax({type:"POST",url:ajaxUrl,data:"ac=addMyApp&id="+g+"&type="+e+"&desk="+HROS.CONFIG.desk,success:function(){HROS.app.get();}});}});}else{alert("信息填写不完整");}},cancel:true});$('#addpapp input[name="addpappType"]').off("change").on("change",function(){if($(this).val()=="papp"){$("#addpapp tbody tr").eq(4).fadeIn();}else{$("#addpapp tbody tr").eq(4).fadeOut();}});$(".popup-menu").hide();});$('.desk-menu a[menu="uploadfile"]').on("click",function(){HROS.uploadFile.getDialog();$(".popup-menu").hide();});$('.desk-menu a[menu="themes"]').on("click",function(){HROS.window.createTemp({id:"ztsz",title:"主题设置",url:"sysapp/wallpaper/index.php",width:580,height:520,isresize:false,isflash:false});$(".popup-menu").hide();});$('.desk-menu a[menu="setting"]').on("click",function(){HROS.window.createTemp({id:"zmsz",title:"桌面设置",url:"sysapp/desksetting/index.php",width:750,height:450,isresize:false,isflash:false});$(".popup-menu").hide();});$('.desk-menu a[menu="logout"]').on("click",function(){HROS.base.logout();$(".popup-menu").hide();});}$('.desk-menu a[menu="orderby"]').each(function(){$(this).prev().hide();if($(this).attr("orderby")==HROS.CONFIG.appXY){$(this).prev().show();}$(".popup-menu").hide();});return TEMP.popupMenuDesk;}};})();HROS.taskbar=(function(){return{init:function(){$("#task-content-inner").off("click").on("click","a.task-item",function(){if($(this).hasClass("task-item-current")){HROS.window.hide($(this).attr("realid"),$(this).attr("type"));}else{HROS.window.show2top($(this).attr("realid"),$(this).attr("type"));}}).off("contextmenu").on("contextmenu","a.task-item",function(a){$(".popup-menu").hide();$(".quick_view_container").remove();HROS.taskbar.rightClick($(this),a.clientX,a.clientY);return false;});},rightClick:function(c,a,d){$(".popup-menu").hide();$(".quick_view_container").remove();var b=HROS.popupMenu.task(c);l=$(document).width()-a<b.width()?a-b.width():a;t=d-b.height();b.css({left:l,top:t}).show();return false;},pageClick:function(c,a){var b=a-c;if(HROS.CONFIG.dockPos=="right"){$("#task-content-inner").animate({marginLeft:0},200);}else{$("#task-content-inner").animate({marginRight:0},200);}$("#task-next a").addClass("disable");$("#task-pre a").removeClass("disable");$("#task-next-btn").off("click").on("click",function(){if($(this).hasClass("disable")==false){if(HROS.CONFIG.dockPos=="right"){var d=parseInt($("#task-content-inner").css("margin-left"))+114;if(d>=0){d=0;$("#task-next a").addClass("disable");}$("#task-pre a").removeClass("disable");$("#task-content-inner").animate({marginLeft:d},200);}else{var e=parseInt($("#task-content-inner").css("margin-right"))+114;if(e>=0){e=0;$("#task-next a").addClass("disable");}$("#task-pre a").removeClass("disable");$("#task-content-inner").animate({marginRight:e},200);}}});$("#task-pre-btn").off("click").on("click",function(){if($(this).hasClass("disable")==false){if(HROS.CONFIG.dockPos=="right"){var d=parseInt($("#task-content-inner").css("margin-left"))-114;if(d<=b*-1){d=b*-1;$("#task-pre a").addClass("disable");}$("#task-next a").removeClass("disable");$("#task-content-inner").animate({marginLeft:d},200);}else{var e=parseInt($("#task-content-inner").css("margin-right"))-114;if(e<=b*-1){e=b*-1;$("#task-pre a").addClass("disable");}$("#task-next a").removeClass("disable");$("#task-content-inner").animate({marginRight:e},200);}}});},resize:function(){if(HROS.CONFIG.dockPos=="left"){$("#task-bar").css({"left":73,"right":0});$("#task-content-inner").removeClass("fl");}else{if(HROS.CONFIG.dockPos=="right"){$("#task-bar").css({"left":0,"right":73});$("#task-content-inner").addClass("fl");}else{$("#task-bar").css({"left":0,"right":0});$("#task-content-inner").removeClass("fl");}}var a=$("#task-bar").width(),c=$("#task-content-inner .task-item").length*114,b=a-112;if(c>=b){$("#task-next, #task-pre").show();$("#task-content").css("width",b);HROS.taskbar.pageClick(b,c);}else{$("#task-next, #task-pre").hide();$("#task-content").css("width","100%");$("#task-content-inner").css({"margin-left":0,"margin-right":0});}}};})();HROS.uploadFile=(function(){var a=[];return{getDialog:function(){var d=[];for(var b=0;b<a.length;b++){d.push({name:a[b].name,size:a[b].size<1048576?Math.round(a[b].size/1024)+" kb":Math.round(a[b].size/1048576*100)/100+" mb"});}var c=uploadFileDialogListTemp({list:d});if(typeof($.dialog.list["uploadfile"])=="object"){$("#uploadfile").html(c);}else{$.dialog({id:"uploadfile",title:"上传文件",padding:0,content:uploadFileDialogTemp({list:c}),button:[{name:"上传",callback:function(){if(a.length!=0){for(var f=0,e;e=a[f];f++){(function(h){var g=new FormData();g.append("xfile",h);var i=new XMLHttpRequest();if(i.upload){i.upload.addEventListener("progress",function(k){if(k.lengthComputable){$("#uploadfile .filelist:eq("+h.index+") .do").html("[&nbsp;--&nbsp;]");var j=Math.ceil(k.loaded/k.total*100);$("#uploadfile .filelist:eq("+h.index+") .progress").css({width:j+"%"});}},false);i.addEventListener("load",function(k){if(i.readyState==4&&i.status==200){var j=jQuery.parseJSON(k.target.responseText);if(j.error==null){$("#uploadfile .filelist:eq("+h.index+") .do").html("[&nbsp;√&nbsp;]");}else{$("#uploadfile .filelist:eq("+h.index+") .do").html("[&nbsp;×&nbsp;]").attr("title",j.error);}}},false);i.open("post","ajax.php?ac=html5upload",true);i.setRequestHeader("X-Requested-With","XMLHttpRequest");i.send(g);}})(e);}a=[];}return false;}},{name:"关闭",callback:function(){a=[];xhr=null;}}]});}},init:function(){if(window.FileReader){var d=document.body;d.addEventListener("dragenter",function(f){f.preventDefault();},false);d.addEventListener("dragleave",function(f){f.preventDefault();},false);d.addEventListener("dragover",function(f){f.preventDefault();},false);d.addEventListener("drop",function(f){f.preventDefault();HROS.uploadFile.getDialog();b(f);HROS.uploadFile.getDialog();},false);}$("body").on("change","#uploadfilebtn",function(f){b(f);HROS.uploadFile.getDialog();});$("body").on("click","#uploadfile .del",function(){var g=$(this).parents(".filelist");var f=g.index();g.slideUp("slow",function(){$(this).remove();});var h=[];for(var e=0;e<a.length;e++){if(e!=f){h.push(a[e]);}}a=h;c();HROS.uploadFile.getDialog();});var b=function(j){var h=j.target.files||j.dataTransfer.files;if(h.length!=0){var g=[];for(var f=0;f<h.length;f++){if(h[f]["size"]>104857600){g.push('"'+h[f]["name"]+'" 文件过大，请上传小于100MB的文件！');}else{a.push(h[f]);}}if(g!=""){contentHtml=g.join("<br>");$.dialog({padding:10,content:contentHtml});}}c();};var c=function(){for(var e=0;e<a.length;e++){a[e]["index"]=e;}console.log(a);};}};})();HROS.wallpaper=(function(){return{get:function(a){$.ajax({type:"POST",url:ajaxUrl,data:"ac=getWallpaper",success:function(c){var b=c.split("<{|}>");HROS.CONFIG.wallpaperState=b[0];switch(b[0]){case"1":case"2":HROS.CONFIG.wallpaper=b[1];HROS.CONFIG.wallpaperType=b[2];HROS.CONFIG.wallpaperWidth=b[3];HROS.CONFIG.wallpaperHeight=b[4];break;case"3":HROS.CONFIG.wallpaper=b[1];break;}if(typeof(a)!="undefined"){a();}}});},set:function(f){var f=typeof(f)=="undefined"?true:f;if(f){$("#zoomWallpaperGrid").remove();}var b=$(window).width(),e=$(window).height();switch(HROS.CONFIG.wallpaperState){case"1":case"2":switch(HROS.CONFIG.wallpaperType){case"pingpu":if(f){$("body").append('<div id="zoomWallpaperGrid" style="position:absolute;z-index:-10;top:0;left:0;height:100%;width:100%;background:url('+HROS.CONFIG.wallpaper+') repeat"></div>');}break;case"juzhong":if(f){$("body").append('<div id="zoomWallpaperGrid" style="position:absolute;z-index:-10;top:0;left:0;height:100%;width:100%;background:url('+HROS.CONFIG.wallpaper+') no-repeat 50% 50%"></div>');}break;case"tianchong":var c=(e-HROS.CONFIG.wallpaperHeight)/2,a=(b-HROS.CONFIG.wallpaperWidth)/2;if(f){$("body").append('<div id="zoomWallpaperGrid" style="position:absolute;z-index:-10;left:0;top:0;overflow:hidden;height:'+e+"px;width:"+b+'px"><img id="zoomWallpaper" style="position:absolute;height:'+HROS.CONFIG.wallpaperHeight+"px;width:"+HROS.CONFIG.wallpaperWidth+"px;top:"+c+"px;left:"+a+'px"><div style="position:absolute;height:'+e+"px;width:"+b+'px;background:#fff;opacity:0;filter:alpha(opacity=0)"></div></div>');$("#zoomWallpaper").attr("src",HROS.CONFIG.wallpaper).on("load",function(){$(this).show();});}else{$("#zoomWallpaperGrid, #zoomWallpaperGrid div").css({height:e+"px",width:b+"px"});$("#zoomWallpaper").css({top:c+"px",left:a+"px"});}break;case"shiying":var g,d,c,a;if(HROS.CONFIG.wallpaperHeight/HROS.CONFIG.wallpaperWidth>e/b){g=e;d=HROS.CONFIG.wallpaperWidth*(e/HROS.CONFIG.wallpaperHeight);c=0;a=(b-d)/2;}else{if(HROS.CONFIG.wallpaperHeight/HROS.CONFIG.wallpaperWidth<e/b){d=b;g=HROS.CONFIG.wallpaperHeight*(b/HROS.CONFIG.wallpaperWidth);a=0;c=(e-g)/2;}else{g=HROS.CONFIG.wallpaperHeight;d=HROS.CONFIG.wallpaperWidth;c=a=0;}}if(f){$("body").append('<div id="zoomWallpaperGrid" style="position:absolute;z-index:-10;left:0;top:0;overflow:hidden;height:'+e+"px;width:"+b+'px"><img id="zoomWallpaper" style="position:absolute;height:'+g+"px;width:"+d+"px;top:"+c+"px;left:"+a+'px"><div style="position:absolute;height:'+e+"px;width:"+b+'px;background:#fff;opacity:0;filter:alpha(opacity=0)"></div></div>');$("#zoomWallpaper").attr("src",HROS.CONFIG.wallpaper).on("load",function(){$(this).show();});}else{$("#zoomWallpaperGrid, #zoomWallpaperGrid div").css({height:e+"px",width:b+"px"});$("#zoomWallpaper").css({height:g+"px",width:d+"px",top:c+"px",left:a+"px"});}break;case"lashen":if(f){$("body").append('<div id="zoomWallpaperGrid" style="position:absolute;z-index:-10;left:0;top:0;overflow:hidden;height:'+e+"px;width:"+b+'px"><img id="zoomWallpaper" style="position:absolute;height:'+e+"px;width:"+b+'px;top:0;left:0"><div style="position:absolute;height:'+e+"px;width:"+b+'px;background:#fff;opacity:0;filter:alpha(opacity=0)"></div></div>');$("#zoomWallpaper").attr("src",HROS.CONFIG.wallpaper).on("load",function(){$(this).show();});}else{$("#zoomWallpaperGrid").css({height:e+"px",width:b+"px"}).children("#zoomWallpaper, div").css({height:e+"px",width:b+"px"});}break;}break;case"3":if(f){$("body").append('<div id="zoomWallpaperGrid" style="position:absolute;z-index:-10;top:0;left:0;height:100%;width:100%;overflow:hidden"><div></div><iframe id="iframeWallpaper" frameborder="no" border="0" class="iframeWallpaper" style="position:absolute;left:0;top:0;overflow:hidden;width:100%;height:100%" src="'+HROS.CONFIG.wallpaper+'"></iframe></div>');}break;}},update:function(b,c,a){$.ajax({type:"POST",url:ajaxUrl,data:"ac=setWallpaper&wpstate="+b+"&wptype="+c+"&wp="+a,success:function(){HROS.wallpaper.get(function(){HROS.wallpaper.set();});}});}};})();HROS.widget=(function(){return{create:function(id,type){var iswidgetopen=false,widgetid;$("#desk .widget").each(function(){if($(this).attr("realid")==id){iswidgetopen=true;}});if(iswidgetopen==false){function nextDo(options){if(HROS.widget.checkCookie(id,type)){if($.cookie("widgetState")){widgetState=eval("("+$.cookie("widgetState")+")");$(widgetState).each(function(){if(this.id==options.id){options.top=this.top;options.left=this.left;options.type=this.type;}});}}else{HROS.widget.addCookie(options.id,options.type,0,0);}$("#desk").append(widgetWindowTemp({"width":options.width,"height":options.height,"type":options.type,"id":"w_"+options.type+"_"+options.id,"realid":options.id,"top":options.top==""?0:options.top,"left":options.left==""?0:options.left,"url":options.url}));var widgetId="#w_"+options.type+"_"+options.id;HROS.widget.handle($(widgetId));HROS.widget.move($(widgetId));}ZENG.msgbox.show("小挂件正在加载中，请耐心等待...",6,100000);$.getJSON(ajaxUrl+"?ac=getMyAppById&id="+id+"&type="+type,function(widget){if(widget!=null){ZENG.msgbox._hide();var options={id:widget["id"],url:widget["url"],width:widget["width"],height:widget["height"],type:widget["type"]};nextDo(options);}else{ZENG.msgbox.show("小挂件加载失败",5,2000);return false;}});}},reduction:function(){if($.cookie("widgetState")){var widgetState=eval("("+$.cookie("widgetState")+")");console.log(widgetState);for(var i=0;i<widgetState.length;i++){HROS.widget.create(widgetState[i].id,widgetState[i].type);}}},checkCookie:function(id,type){var flag=false;if($.cookie("widgetState")){widgetState=eval("("+$.cookie("widgetState")+")");$(widgetState).each(function(){if(this.id==id&&this.type==type){flag=true;}});}return flag;},addCookie:function(id,type,top,left){if(!HROS.widget.checkCookie(id,type)){var json=[];if($.cookie("widgetState")){var widgetState=eval("("+$.cookie("widgetState")+")"),len=0;for(var i=0;i<len;i++){json.push("{'id':'"+widgetState[i].id+"','type':'"+widgetState[i].type+"','top':'"+widgetState[i].top+"','left':'"+widgetState[i].left+"'}");}}json.push("{'id':'"+id+"','type':'"+type+"','top':'"+top+"','left':'"+left+"'}");$.cookie("widgetState","["+json.join(",")+"]",{expires:95});}},updateCookie:function(id,type,top,left){if(HROS.widget.checkCookie(id,type)){var widgetState=eval("("+$.cookie("widgetState")+")"),len=widgetState.length,json=[];for(var i=0;i<len;i++){if(widgetState[i].id==id){json.push("{'id':'"+id+"','type':'"+type+"','top':'"+top+"','left':'"+left+"'}");}else{json.push("{'id':'"+widgetState[i].id+"','type':'"+widgetState[i].type+"','top':'"+widgetState[i].top+"','left':'"+widgetState[i].left+"'}");}}$.cookie("widgetState","["+json.join(",")+"]",{expires:95});}},removeCookie:function(id,type){if(HROS.widget.checkCookie(id,type)){var widgetState=eval("("+$.cookie("widgetState")+")"),len=widgetState.length,json=[];for(var i=0;i<len;i++){if(widgetState[i].id!=id){json.push("{'id':'"+widgetState[i].id+"','type':'"+widgetState[i].type+"','top':'"+widgetState[i].top+"','left':'"+widgetState[i].left+"'}");}}$.cookie("widgetState","["+json.join(",")+"]",{expires:95});}},move:function(obj){obj.on("mousedown",".move",function(e){var lay,x,y;x=e.clientX-obj.offset().left;y=e.clientY-obj.offset().top;$(document).on("mousemove",function(e){lay=HROS.maskBox.desk();lay.show();_l=e.clientX-x;_t=e.clientY-y;_t=_t<0?0:_t;obj.css({left:_l,top:_t});}).on("mouseup",function(){$(this).off("mousemove").off("mouseup");if(typeof(lay)!=="undefined"){lay.hide();}HROS.widget.updateCookie(obj.attr("realid"),obj.attr("type"),_t,_l);});});},close:function(id,type){var widgetId="#w_"+type+"_"+id;$(widgetId).html("").remove();HROS.widget.removeCookie(id,type);},handle:function(obj){obj.on("click",".ha-close",function(){HROS.widget.close(obj.attr("realid"),obj.attr("type"));});}};})();HROS.window=(function(){return{createTemp:function(d){$(".popup-menu").hide();$(".quick_view_container").remove();var a="app",e=typeof(d.id)=="undefined"||d.id==""?Date.parse(new Date()):d.id;var c=false;$("#task-content-inner a.task-item").each(function(){if($(this).attr("realid")==e&&$(this).attr("type")==a){c=true;HROS.window.show2top(e,a);}});if(c==false){function b(g){var f="#w_"+g.type+"_"+g.id;$("#task-content-inner").prepend(taskTemp({"type":g.type,"id":"t_"+g.type+"_"+g.id,"realid":g.id,"title":g.title,"imgsrc":g.imgsrc}));$("#task-content-inner").css("width",$("#task-content-inner .task-item").length*114);HROS.taskbar.resize();TEMP.windowTemp={"width":g.width,"height":g.height,"top":($(window).height()-g.height)/2<=0?0:($(window).height()-g.height)/2,"left":($(window).width()-g.width)/2<=0?0:($(window).width()-g.width)/2,"emptyW":$(window).width()-g.width,"emptyH":$(window).height()-g.height,"zIndex":HROS.CONFIG.createIndexid,"type":g.type,"id":"w_"+g.type+"_"+g.id,"realid":g.id,"title":g.title,"url":g.url,"imgsrc":g.imgsrc,"isresize":g.isresize==1?true:false,"istitlebar":g.isresize==1?true:false,"istitlebarFullscreen":g.isresize==1?window.fullScreenApi.supportsFullScreen==true?true:false:false,"issetbar":g.issetbar==1?true:false,"isflash":g.isflash==1?true:false};$("#desk").append(windowTemp(TEMP.windowTemp));$(f).data("info",TEMP.windowTemp);HROS.CONFIG.createIndexid+=1;$(f).find("iframe").on("load",function(){if(g.isresize){HROS.window.resize($(f));}$(f+" .window-frame").children("div").eq(1).fadeOut();});$(f).on("contextmenu",function(){return false;});HROS.window.handle($(f));HROS.window.move($(f));$(".window-mask").off("click").on("click",function(){HROS.window.show2top($(this).parents(".window-container").attr("realid"),$(this).parents(".window-container").attr("type"));});HROS.window.show2top(g.id,g.type);}b({type:"app",id:typeof(d.id)=="undefined"||d.id==""?Date.parse(new Date()):d.id,imgsrc:"img/ui/default_icon.png",title:d.title,url:d.url,width:d.width,height:d.height,isresize:d.isresize,issetbar:false,isflash:typeof(d.isflash)=="undefined"||d.id==""?true:d.isflash});}},create:function(d,a){$(".popup-menu").hide();$(".quick_view_container").remove();var c=false;$("#task-content-inner a.task-item").each(function(){if($(this).attr("realid")==d&&$(this).attr("type")==a){c=true;HROS.window.show2top(d,a);}});if(c==false){function b(f){var e="#w_"+f.type+"_"+f.id;var i=($(window).height()-f.height)/2<=0?0:($(window).height()-f.height)/2;var h=($(window).width()-f.width)/2<=0?0:($(window).width()-f.width)/2;switch(f.type){case"app":case"papp":$("#task-content-inner").prepend(taskTemp({"type":f.type,"id":"t_"+f.type+"_"+f.id,"realid":f.id,"title":f.title,"imgsrc":f.imgsrc}));$("#task-content-inner").css("width",$("#task-content-inner .task-item").length*114);HROS.taskbar.resize();TEMP.windowTemp={"width":f.width,"height":f.height,"top":i,"left":h,"emptyW":$(window).width()-f.width,"emptyH":$(window).height()-f.height,"zIndex":HROS.CONFIG.createIndexid,"type":f.type,"id":"w_"+f.type+"_"+f.id,"realid":f.id,"title":f.title,"url":f.url,"imgsrc":f.imgsrc,"isresize":f.isresize==1?true:false,"istitlebar":f.isresize==1?true:false,"istitlebarFullscreen":f.isresize==1?window.fullScreenApi.supportsFullScreen==true?true:false:false,"issetbar":f.issetbar==1?true:false,"isflash":f.isflash==1?true:false};$("#desk").append(windowTemp(TEMP.windowTemp));$(e).data("info",TEMP.windowTemp);HROS.CONFIG.createIndexid+=1;$(e+" iframe").on("load",function(){if(f.isresize){HROS.window.resize($(e));}$(e+" .window-frame").children("div").eq(1).fadeOut();});$(e).on("contextmenu",function(){return false;});HROS.window.handle($(e));HROS.window.move($(e));$(".window-mask").off("click").on("click",function(){HROS.window.show2top($(this).parents(".window-container").attr("realid"),$(this).parents(".window-container").attr("type"));});HROS.window.show2top(f.id,f.type);break;case"folder":$("#task-content-inner").prepend(taskTemp({"type":f.type,"id":"t_"+f.type+"_"+f.id,"realid":f.id,"title":f.title,"imgsrc":f.imgsrc}));$("#task-content-inner").css("width",$("#task-content-inner .task-item").length*114);HROS.taskbar.resize();TEMP.folderWindowTemp={"width":f.width,"height":f.height,"top":i,"left":h,"emptyW":$(window).width()-f.width,"emptyH":$(window).height()-f.height,"zIndex":HROS.CONFIG.createIndexid,"type":f.type,"id":"w_"+f.type+"_"+f.id,"realid":f.id,"title":f.title,"imgsrc":f.imgsrc};$("#desk").append(folderWindowTemp(TEMP.folderWindowTemp));$(e).data("info",TEMP.folderWindowTemp);HROS.CONFIG.createIndexid+=1;$.getJSON(ajaxUrl+"?ac=getMyFolderApp&folderid="+f.id,function(k){if(k!=null){for(var j=0;j<k.length;j++){switch(k[j]["type"]){case"app":case"widget":$(e).find(".folder_body").append(appbtnTemp({"top":0,"left":0,"title":k[j]["name"],"type":k[j]["type"],"id":"d_"+k[j]["type"]+"_"+k[j]["id"],"realid":k[j]["id"],"imgsrc":k[j]["icon"]}));break;case"folder":$(e).find(".folder_body").append(appbtnTemp({"top":0,"left":0,"title":k[j]["name"],"type":k[j]["type"],"id":"d_"+k[j]["type"]+"_"+k[j]["id"],"realid":k[j]["id"],"imgsrc":k[j]["icon"]}));break;}}HROS.app.move();}g();});function g(){$(e).on("contextmenu",function(){return false;});$(e+" .folder_body").on("contextmenu",".appbtn",function(n){$(".popup-menu").hide();$(".quick_view_container").remove();var m=HROS.popupMenu.app($(this));var j=($(document).width()-n.clientX)<m.width()?(n.clientX-m.width()):n.clientX;var k=($(document).height()-n.clientY)<m.height()?(n.clientY-m.height()):n.clientY;m.css({left:j,top:k}).show();return false;});HROS.window.resize($(e));$(e+" .window-frame").children("div").eq(1).fadeOut();HROS.window.handle($(e));HROS.window.move($(e));$(".window-mask").off("click").on("click",function(){HROS.window.show2top($(this).parents(".window-container").attr("realid"),$(this).parents(".window-container").attr("type"));});HROS.window.show2top(f.id,f.type);}break;}}ZENG.msgbox.show("应用正在加载中，请耐心等待...",6,100000);$.getJSON(ajaxUrl+"?ac=getMyAppById&id="+d+"&type="+a,function(e){if(e!=null){ZENG.msgbox._hide();switch(e["type"]){case"app":case"papp":case"widget":case"pwidget":b({type:e["type"],id:e["id"],title:e["name"],imgsrc:e["icon"],url:e["url"],width:e["width"],height:e["height"],isresize:e["isresize"],issetbar:e["issetbar"],isflash:e["isflash"]});break;case"folder":b({type:e["type"],id:e["id"],title:e["name"],imgsrc:e["icon"],width:e["width"],height:e["height"]});break;}}else{ZENG.msgbox.show("数据拉取失败",5,2000);return false;}});}},close:function(d,c){var a="#w_"+c+"_"+d,b="#t_"+c+"_"+d;$(a).removeData("info").html("").remove();$("#task-content-inner "+b).html("").remove();$("#task-content-inner").css("width",$("#task-content-inner .task-item").length*114);$("#task-bar, #nav-bar").removeClass("min-zIndex");HROS.taskbar.resize();},closeAll:function(){$("#desk .window-container").each(function(){HROS.window.close($(this).attr("realid"),$(this).attr("type"));});},hide:function(d,c){HROS.window.show2top(d,c);var a="#w_"+c+"_"+d,b="#t_"+c+"_"+d;$(a).css("visibility","hidden");$("#task-content-inner "+b).removeClass("task-item-current");if($(a).attr("ismax")==1){$("#task-bar, #nav-bar").removeClass("min-zIndex");}},hideAll:function(){$("#task-content-inner a.task-item").removeClass("task-item-current");$("#desk-"+HROS.CONFIG.desk).nextAll("div.window-container").css("visibility","hidden");},max:function(d,c){HROS.window.show2top(d,c);var a="#w_"+c+"_"+d,b="#t_"+c+"_"+d;$(a+" .title-handle .ha-max").hide().next(".ha-revert").show();$(a).attr("ismax",1).animate({width:"100%",height:"100%",top:0,left:0},200);$("#task-bar, #nav-bar").addClass("min-zIndex");},revert:function(f,c){HROS.window.show2top(f,c);var a="#w_"+c+"_"+f,b="#t_"+c+"_"+f;$(a+" .title-handle .ha-revert").hide().prev(".ha-max").show();var d=$(a),e=d.data("info");d.attr("ismax",0).animate({width:e["width"],height:e["height"],left:e["left"],top:e["top"]},500);$("#task-bar, #nav-bar").removeClass("min-zIndex");},refresh:function(d,c){HROS.window.show2top(d,c);var a="#w_"+c+"_"+d,b="#t_"+c+"_"+d;if($(a+"_iframe").length!=0){$(a+"_iframe").attr("src",$(a+"_iframe").attr("src"));}else{HROS.window.updateFolder(d,c);}},show2top:function(d,c){var a="#w_"+c+"_"+d,b="#t_"+c+"_"+d;$("#task-content-inner a.task-item").removeClass("task-item-current");$("#task-content-inner "+b).addClass("task-item-current");if($(a).attr("ismax")==1){$("#task-bar, #nav-bar").addClass("min-zIndex");}$("#desk .window-container .window-container").removeClass("window-current");$(a).addClass("window-current").css({"z-index":HROS.CONFIG.createIndexid,"visibility":"visible"});$("#desk .window-container .window-mask").show();$(a+" .window-mask").hide();$("#desk .window-container-flash iframe").hide();$(a+" iframe").show();HROS.CONFIG.createIndexid+=1;},updateFolder:function(d,c){HROS.window.show2top(d,c);var a="#w_"+c+"_"+d,b="#t_"+c+"_"+d;$.getJSON(ajaxUrl+"?ac=getMyFolderApp&folderid="+d,function(g){if(g!=null){var e="";for(var f=0;f<g.length;f++){switch(g[f]["type"]){case"app":case"widget":e+=appbtnTemp({"top":0,"left":0,"title":g[f]["name"],"type":g[f]["type"],"id":"d_"+g[f]["type"]+"_"+g[f]["id"],"realid":g[f]["id"],"imgsrc":g[f]["icon"]});break;}}$(a).find(".folder_body").html("").append(e).on("contextmenu",".shortcut",function(j){$(".popup-menu").hide();$(".quick_view_container").remove();TEMP.AppRight=HROS.popupMenu.app($(this));var h=($(document).width()-j.clientX)<TEMP.AppRight.width()?(j.clientX-TEMP.AppRight.width()):j.clientX;var i=($(document).height()-j.clientY)<TEMP.AppRight.height()?(j.clientY-TEMP.AppRight.height()):j.clientY;TEMP.AppRight.css({left:h,top:i}).show();return false;});HROS.app.move();}});},handle:function(a){a.on("dblclick",".title-bar",function(b){if(a.find(".ha-max").is(":hidden")){a.find(".ha-revert").click();}else{a.find(".ha-max").click();}}).on("click",".ha-hide",function(){HROS.window.hide(a.attr("realid"),a.attr("type"));}).on("click",".ha-max",function(){HROS.window.max(a.attr("realid"),a.attr("type"));}).on("click",".ha-revert",function(){HROS.window.revert(a.attr("realid"),a.attr("type"));}).on("click",".ha-fullscreen",function(){window.fullScreenApi.requestFullScreen(document.getElementById(a.find("iframe").attr("id")));}).on("click",".ha-close",function(){HROS.window.close(a.attr("realid"),a.attr("type"));}).on("click",".refresh",function(){HROS.window.refresh(a.attr("realid"),a.attr("type"));}).on("click",".help",function(){var b=art.dialog({title:"帮助",follow:this,width:196});$.ajax({type:"POST",url:ajaxUrl,data:"ac=getAppRemark&id="+a.data("info").realid,success:function(c){b.content(c);}});}).on("click",".star",function(){$.ajax({type:"POST",url:ajaxUrl,data:"ac=getAppStar&id="+a.data("info").realid,success:function(b){$.dialog({title:"给“"+a.data("info").title+"”打分",width:250,id:"star",content:starDialogTemp({"point":Math.floor(b),"realpoint":b*20})});$("#star ul").data("id",a.data("info").realid);}});$("body").off("click").on("click","#star ul li",function(){var b=$(this).attr("num");var c=$(this).parent("ul").data("id");if(!isNaN(b)&&/^[1-5]$/.test(b)){$.ajax({type:"POST",url:ajaxUrl,data:"ac=updateAppStar&id="+c+"&starnum="+b,success:function(d){art.dialog.list["star"].close();if(d){ZENG.msgbox.show("打分成功！",4,2000);}else{ZENG.msgbox.show("你已经打过分了！",1,2000);}}});}});}).on("contextmenu",".window-container",function(){$(".popup-menu").hide();$(".quick_view_container").remove();return false;});},move:function(a){a.on("mousedown",".title-bar",function(d){if(a.attr("ismax")==1){return false;}HROS.window.show2top(a.attr("realid"),a.attr("type"));var f=a.data("info"),c,b,g;b=d.clientX-a.offset().left;g=d.clientY-a.offset().top;$(document).on("mousemove",function(h){c=HROS.maskBox.desk();c.show();a.find(".ha-revert").hide().prev(".ha-max").show();_l=h.clientX-b;_t=h.clientY-g;_w=f["width"];_h=f["height"];_t=_t<=10?0:_t>=c.height()-30?c.height()-30:_t;a.css({width:_w,height:_h,left:_l,top:_t});a.data("info").left=a.offset().left;a.data("info").top=a.offset().top;}).on("mouseup",function(){$(this).off("mousemove").off("mouseup");if(typeof(c)!=="undefined"){c.hide();}});});},resize:function(a){a.find("div.window-resize").on("mousedown",function(i){var f=$(this),d,b=i.clientX,j=i.clientY,c=a.width(),g=a.height();$(document).on("mousemove",function(h){d=HROS.maskBox.desk();d.show();_x=h.clientX;_y=h.clientY;_x=_x<=10?0:_x>=(d.width()-12)?(d.width()-2):_x;_y=_y<=10?0:_y>=(d.height()-12)?d.height():_y;switch(f.attr("resize")){case"t":g+j-_y>HROS.CONFIG.windowMinHeight?a.css({height:g+j-_y,top:_y}):a.css({height:HROS.CONFIG.windowMinHeight});break;case"r":c-b+_x>HROS.CONFIG.windowMinWidth?a.css({width:c-b+_x}):a.css({width:HROS.CONFIG.windowMinWidth});break;case"b":g-j+_y>HROS.CONFIG.windowMinHeight?a.css({height:g-j+_y}):a.css({height:HROS.CONFIG.windowMinHeight});break;case"l":c+b-_x>HROS.CONFIG.windowMinWidth?a.css({width:c+b-_x,left:_x}):a.css({width:HROS.CONFIG.windowMinWidth});break;case"rt":g+j-_y>HROS.CONFIG.windowMinHeight?a.css({height:g+j-_y,top:_y}):a.css({height:HROS.CONFIG.windowMinHeight});c-b+_x>HROS.CONFIG.windowMinWidth?a.css({width:c-b+_x}):a.css({width:HROS.CONFIG.windowMinWidth});break;case"rb":c-b+_x>HROS.CONFIG.windowMinWidth?a.css({width:c-b+_x}):a.css({width:HROS.CONFIG.windowMinWidth});g-j+_y>HROS.CONFIG.windowMinHeight?a.css({height:g-j+_y}):a.css({height:HROS.CONFIG.windowMinHeight});break;case"lt":c+b-_x>HROS.CONFIG.windowMinWidth?a.css({width:c+b-_x,left:_x}):a.css({width:HROS.CONFIG.windowMinWidth});g+j-_y>HROS.CONFIG.windowMinHeight?a.css({height:g+j-_y,top:_y}):a.css({height:HROS.CONFIG.windowMinHeight});break;case"lb":c+b-_x>HROS.CONFIG.windowMinWidth?a.css({width:c+b-_x,left:_x}):a.css({width:HROS.CONFIG.windowMinWidth});g-j+_y>HROS.CONFIG.windowMinHeight?a.css({height:g-j+_y}):a.css({height:HROS.CONFIG.windowMinHeight});break;}}).on("mouseup",function(){if(typeof(d)!=="undefined"){d.hide();}a.data("info").width=a.width();a.data("info").height=a.height();a.data("info").left=a.offset().left;a.data("info").top=a.offset().top;a.data("info").emptyW=$(window).width()-a.width();a.data("info").emptyH=$(window).height()-a.height();$(this).off("mousemove").off("mouseup");});});}};})();HROS.zoom=(function(){return{init:function(){$("body").append('<div id="zoombox"></div>');swfobject.embedSWF("js/zoom.swf?onchange=HROS.zoom.check","zoombox","10","10","6.0.0","expressInstall.swf","",{allowScriptAccess:"always",wmode:"transparent",scale:"noScale"},{id:"accessory_zoom",name:"zoom_detect"});},check:function(c){var b=c.scale,a=b>1?"放大":"缩小";if(b!=1){zoomlevel=b;$("#zoom-tip").show().find("span").text("您的浏览器目前处于"+a+"状态，会导致显示不正常，您可以键盘按“ctrl+数字0”组合键恢复初始状态！");}else{if(b!=zoomlevel){$("#zoom-tip").fadeOut();}}},close:function(){$("#zoom-tip").remove();}};})();